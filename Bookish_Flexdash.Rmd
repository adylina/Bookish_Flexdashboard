---
title: "Bookish Flexdash"
author: "Amanda Dylina Morse, MPH"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: 
  flexdashboard::flex_dashboard:
    storyboard: true
    theme: united
---

```{r setup, include=FALSE}

###############################################################################################
#                     INSTRUCTIONS FOR RUNNING YOUR BOOKISH FLEXDASH
#
#   1. Change the google sheets url on line 49
#   2. Click the "run chunk" green arrow to the far left on line 11
#       You may get a prompt to authenticate your google account --> you need to do so
#   3. Click "knit" up in the navigation bar
#   4. Enjoy!
#
###############################################################################################


#load some packages --> add them to your library if you don't have them already loaded
list.of.packages <- c("dplyr", "flexdashboard", "ggraph", "ggplot2", "googlesheets4", "hrbrthemes", 
                      "igraph", "kableExtra","tidyverse", "tidytext", "viridis", "wesanderson")

new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]

if(length(new.packages)) 
  install.packages(new.packages)

library(dplyr)
#library(flexdashboard)
library(ggraph)
library(ggplot2)
library(googlesheets4)
#library(hrbrthemes)
library(igraph)
library(kableExtra)
library(tidyverse)
library(tidytext)
library(viridis)
library(wesanderson)


# import the kraken 
TBR <- read_sheet("your_url_goes_between_these_quotation_marks")

# clean up the months
TBR <- TBR %>%
  mutate(Month = ifelse(Month == "January", "Jan", Month)) %>%
  mutate(Month = ifelse(Month == "February", "Feb", Month)) %>%
  mutate(Month = ifelse(Month == "March", "Mar", Month)) %>%
  mutate(Month = ifelse(Month == "April", "Apr", Month)) %>%
  mutate(Month = ifelse(Month == "May", "May", Month)) %>%
  mutate(Month = ifelse(Month == "June", "Jun", Month)) %>%
  mutate(Month = ifelse(Month == "July", "Jul", Month)) %>%
  mutate(Month = ifelse(Month == "August", "Aug", Month)) %>%
  mutate(Month = ifelse(Month == "September", "Sep", Month)) %>%
  mutate(Month = ifelse(Month == "October", "Oct", Month)) %>%
  mutate(Month = ifelse(Month == "November", "Nov", Month)) %>%
  mutate(Month = ifelse(Month == "December", "Dec", Month))

TBR$Month <- ordered(TBR$Month, 
                     levels=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep",
                              "Oct", "Nov", "Dec"))


# wee summary table of key metrics for each month and year
reading_summary <- TBR %>%
  group_by(Year, Month) %>%
  filter(!is.na(Month)) %>%
  summarise(sum(Start_Finish, na.rm = T), sum(Pages, na.rm = T), mean(Rating, na.rm = T), sum(Single_Day, na.rm = T)) %>%
  rename(Books_Read = "sum(Start_Finish, na.rm = T)", Pages = "sum(Pages, na.rm = T)", 
         Mean_Rating = "mean(Rating, na.rm = T)", Single_Day = "sum(Single_Day, na.rm = T)")

reading_summary$Mean_Rating <- round(reading_summary$Mean_Rating, digits = 2)


# create levels for the months so they're properly ordered in visualisations
reading_summary$Month <- ordered(reading_summary$Month, 
                                 levels=c("Jan", "Feb", "Mar", "Apr", "May", "Jun", "Jul", "Aug", "Sep",
                                          "Oct", "Nov", "Dec"))

```

All Reads {data-navmenu="Reading Overview"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network from review text

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

bigrams <- TBR %>%
  filter((!is.na(Notes)), (Start_Finish == "1")) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)

bigrams$bigram <- tolower(bigrams$bigram)


# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)


#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()

```

### Number of books read each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_Finish, na.rm = T)) %>%
  rename(`Books Read` = "sum(Start_Finish, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Books Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Books Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Column
-----------------------------------------------------------------------

### Average rating by month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(mean(Rating, na.rm = T)) %>%
  rename(`Mean Rating` = "mean(Rating, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Mean Rating`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Mean Rating of Books Read Each Month",
       y = "Mean Rating",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

To Be Read List {data-navmenu="Reading Overview"}
=====================================

Column
-----------------------------------------------------------------------

### Preorders

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR %>%
  filter(Preorder == "1") %>%
  select(c(Author, Title, Notes)) %>%
  kable(caption = "Books on Preorder") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))

```

### Library holds

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
TBR %>%
  filter(Library_Hold == "1") %>%
  select(c(Author, Title, Series)) %>%
  kable(caption = "Books on Hold from the Library") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))

```

Column
-----------------------------------------------------------------------

### TBR list

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR %>%
  filter((is.na(Start_Finish)) & (is.na(Start_DNF)) & (is.na(Preorder)) & (is.na(Library_Hold)) ) %>%
  select(c(Author, Title, Series)) %>%
#  arrange(Author, Series, Series_Order) %>%
  kable(caption = "Books I'll Eventually Get Around to Reading") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))

```


2020 {data-navmenu="Annual Reading"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network from review text

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

bigrams <- subset(TBR, Year == "2020")

bigrams$Notes <- tolower(bigrams$Notes)

bigrams <- bigrams %>%
  filter(!is.na(Notes)) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)


# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)


#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()

```

### Number of books read each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Year == "2020") & (!is.na(Month)) & (Start_Finish == "1")) %>%
#  filter(Start_Finish == "1") %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_Finish)) %>%
  rename(`Books Read` = "sum(Start_Finish)") %>%
  ggplot(aes(x = Month, y = `Books Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Books Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "none") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))


```

Column
-----------------------------------------------------------------------

### Average rating by month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Year == "2020") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(mean(Rating, na.rm = T)) %>%
  rename(`Mean Rating` = "mean(Rating, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Mean Rating`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Mean Rating of Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Mean Rating",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "none") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Year == "2020") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "none") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

2021 {data-navmenu="Annual Reading"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network from review text

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

bigrams <- subset(TBR, Year == "2021")

bigrams$Notes <- tolower(bigrams$Notes)

bigrams <- bigrams %>%
  filter(!is.na(Notes)) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)


# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)



#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()

```

### Number of books read each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Year == "2021") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_Finish)) %>%
  rename(`Books Read` = "sum(Start_Finish)") %>%
  ggplot(aes(x = Month, y = `Books Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Books Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "none") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Column
-----------------------------------------------------------------------

### Average rating by month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Year == "2021") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(mean(Rating, na.rm = T)) %>%
  rename(`Mean Rating` = "mean(Rating, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Mean Rating`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Mean Rating of Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Mean Rating",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "none") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Year == "2021") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "none") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Five Star Reads {data-navmenu="Reads"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network from review text

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

bigrams <- subset(TBR, Rating == "5")

bigrams$Notes <- tolower(bigrams$Notes)

bigrams <- bigrams %>%
  filter(!is.na(Notes)) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)


# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)


#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()




```

### Number of books read each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Rating == "5") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_Finish)) %>%
  rename(`Books Read` = "sum(Start_Finish)") %>%
  ggplot(aes(x = Month, y = `Books Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of 5 Star Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Books Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))


```

Column
-----------------------------------------------------------------------

### Table of 5 star reads

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR %>%
  filter((Rating == "5") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Author, Title, Series, Series_Order) %>%
  summarise(sum(Start_Finish, na.rm = T)) %>%
  arrange(Author, Series, Series_Order) %>%
  select(-Series, -Series_Order) %>%
  rename(`Times Read` = "sum(Start_Finish, na.rm = T)") %>%
  select(Author, Title, Series, `Times Read`) %>%
  kable(caption = "5 Star Reads") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))

```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Rating == "5") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month in 5 Star Books",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Three and Four Star Reads {data-navmenu="Reads"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network from review text

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

bigrams <- subset(TBR, (Rating >= "3") & (Rating < "5"))

bigrams$Notes <- tolower(bigrams$Notes)

bigrams <- bigrams %>%
  filter(!is.na(Notes)) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)


# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)


#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()




```

### Number of books read each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Rating >= "3") & (Rating < "5") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_Finish)) %>%
  rename(`Books Read` = "sum(Start_Finish)") %>%
  ggplot(aes(fill = Year, x = Month, y = `Books Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of 3 and 4 Star Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Books Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))


```

Column
-----------------------------------------------------------------------

### Table of 3 and 4 star reads

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR %>%
  filter((Rating >= "3") & (Rating < "5") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Author, Title, Series, Series_Order) %>%
  summarise(sum(Start_Finish, na.rm = T)) %>%
  arrange(Author, Series, Series_Order) %>%
  select(-Series, -Series_Order) %>%
  rename(`Times Read` = "sum(Start_Finish, na.rm = T)") %>%
  select(Author, Title, Series, `Times Read`) %>%
  kable(caption = "3 and 4 Star Reads") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))

```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Rating >= "3") & (Rating < "5") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month in 3 and 4 Star Books",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Regrettable Reads {data-navmenu="Reads"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network from review text

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

bigrams <- subset(TBR, Rating < "3")

bigrams$Notes <- tolower(bigrams$Notes)

bigrams <- bigrams %>%
  filter(!is.na(Notes)) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)


# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)


#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()

```

### Number of books read each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Rating < "3") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_Finish)) %>%
  rename(`Books Read` = "sum(Start_Finish)") %>%
  ggplot(aes(x = Month, y = `Books Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of Regrettable Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Books Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Column
-----------------------------------------------------------------------

### Table of regrettable reads

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR %>%
  filter((Rating < "3") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Author, Title, Series, Series_Order) %>%
  summarise(sum(Start_Finish, na.rm = T)) %>%
  arrange(Author, Series, Series_Order) %>%
  select(-Series, -Series_Order) %>%
  rename(`Times Read` = "sum(Start_Finish, na.rm = T)") %>%
  select(Author, Title, Series, `Times Read`) %>%
  kable(caption = "Regrettable Reads") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))

```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Rating < "3") & (!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month in Regrettable Books",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Re-Reads {data-navmenu="Reads"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network of reviews for re-reads

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

bigrams <- TBR %>%
#  filter(!is.na (Start_Finish)) %>%
  group_by(Title) %>%
  count(Title) %>%
  filter(n >1) %>%
  add_column(Notes = NA)

bigrams <- inner_join(bigrams, TBR,
                        by=c("Title" = "Title"))

bigrams <- bigrams %>%
  select(c(Title, Notes.y)) %>%
  rename(Notes = Notes.y) %>%
  filter(!is.na(Notes)) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)

bigrams$bigram <- tolower(bigrams$bigram)


# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)


# drop the Title column
super_bigrams = subset (super_bigrams, select = c(-Title))


#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()

```

### Number of books read each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

re_reads <- TBR %>%
  group_by(Title) %>%
  count(Title) %>%
  filter(n >1) %>%
  add_column(Notes = NA)

re_reads <- inner_join(re_reads, TBR,
                        by=c("Title" = "Title"))

re_reads %>%
  filter((!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_Finish)) %>%
  rename(`Books Read` = "sum(Start_Finish)") %>%
  ggplot(aes(x = Month, y = `Books Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of Re-Read Books Read Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Re-Read Books Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))


```

Column
-----------------------------------------------------------------------

### Table of re-reads and their ratings

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR %>%
  group_by(Author, Title, Series, Series_Order) %>%
#  distinct(Title) %>%
#  select(c(Author, Title)) %>%
  summarise(sum(Start_Finish, na.rm = T), mean(Rating, na.rm = T)) %>%
  rename(`Times Read` = "sum(Start_Finish, na.rm = T)", Rating = "mean(Rating, na.rm = T)") %>%
  filter(`Times Read` >1) %>%
  arrange(Author, Series, Series_Order) %>%
  select(-Series, -Series_Order) %>%
  select(Author, Title, Series, `Times Read`, Rating) %>%
  kable(caption = "Re-Reads") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))
  
```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

re_reads <- TBR %>%
  group_by(Title) %>%
  count(Title) %>%
  filter(n >1) %>%
  add_column(Notes = NA)

re_reads <- inner_join(re_reads, TBR,
                        by=c("Title" = "Title"))

re_reads %>%
  filter((!is.na(Month)) & (Start_Finish == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month in Re-Read Books",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Did Not Finish {data-navmenu="Reads"}
=====================================

Column
-----------------------------------------------------------------------

### Bigram network from review text

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}
bigrams <- subset(TBR, Start_DNF == "1")

bigrams$Notes <- tolower(bigrams$Notes)

bigrams <- bigrams %>%
  filter(!is.na(Notes)) %>%
  unnest_tokens(bigram, Notes, token = "ngrams", n = 2)



# move the bigram column to the front
bigrams <- bigrams %>%
  select(bigram, everything())


# break them up
super_bigrams <- bigrams %>%
  separate(bigram, c("word1", "word2"), sep = " ")

# filter off stopwords
super_bigrams <- super_bigrams %>%
  filter(!word1 %in% stop_words$word) %>%
  filter(!word2 %in% stop_words$word)


#####
# visualise the relationships between bigrams
#####

library(igraph)

bigram_graph <- super_bigrams %>%
  count(word1, word2, sort = TRUE) %>%
  filter(n > 1) %>%
  top_n(25) %>%
  graph_from_data_frame()


# print
library(ggraph)
set.seed(2017)

ggraph(bigram_graph, layout = "fr") +
  geom_edge_link() +
  geom_node_point(color = '#20A387FF', size = 1.5) +
  ggtitle("Bigram Network of Book Review Text") +
  geom_node_text(aes(label = name), repel = T, vjust = .5, hjust = .5) +
  theme_void()

```

### Number of DNF books each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Start_DNF == "1") & (!is.na(Month)) & (Start_DNF == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Start_DNF)) %>%
  rename(`Books Not Finished` = "sum(Start_DNF)") %>%
  ggplot(aes(x = Month, y = `Books Not Finished`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Count of Books Put Down without Finishing Each Month",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Books Not Finished",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

Column
-----------------------------------------------------------------------

### Table of DNF reads

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR %>%
  filter((Start_DNF == "1"), (!is.na(Month))) %>%
  select(c(Year, Month, Author, Title, Series)) %>%
  arrange(Year, Month, Author, Series) %>%
#  group_by(Author, Title) %>%
  kable(caption = "DNF Reads") %>%
  kable_styling(bootstrap_options = c("striped", "hover", "responsive", "condensed"))

```

### Number of pages each month

```{r eval=TRUE, echo=FALSE, error=FALSE, message=FALSE, warning=FALSE}

TBR$Year <- as.factor(TBR$Year)
TBR$Month <- as.factor(TBR$Month)

TBR %>%
  filter((Start_DNF == "1") & (!is.na(Month)) & (Start_DNF == "1")) %>%
  group_by(Year, Month) %>%
  summarise(sum(Pages, na.rm = T)) %>%
  rename(`Pages Read` = "sum(Pages, na.rm = T)") %>%
  ggplot(aes(x = Month, y = `Pages Read`, group = Year)) +
  geom_line(aes (col = Year)) + 
  geom_point(aes (col = Year)) +
  scale_colour_discrete(name = "Year") +
  expand_limits(y = 0) +
  labs(title = "Pages Read Each Month in DNF Books",
#       caption = "Source: Amanda's Reading Log",
       y = "Number of Pages Read",
       x = "Month") +
  theme_classic() +
  theme(strip.background = element_rect(fill = "#FFFFFF"),
        text = element_text(size = 14), 
        axis.text.x = element_text(angle = 45, size = 12, vjust = 1.0, hjust = 1.0),
        legend.title = element_blank(),
        plot.title = element_text(size = 15),
        legend.position = "bottom") +
  scale_colour_manual(values = wes_palette("IsleofDogs1"))

```

